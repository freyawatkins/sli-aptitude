---
title: "Sign Language Interpreter Aptitude"
subtitle: "02 - Change over time analysis"
author:
  - name: "Freya Watkins"
    affiliation: "University of Birmingham"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 5
    number_sections: false
    theme: flatly
    highlight: haddock
---

# Setup
```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, cache = FALSE)
```

## Load packages
```{r load_packages, message = FALSE, warning = FALSE}
library(here) # file organisation & folder location
library(tidyverse) # data wrangling & plotting
library(PupillometryR) # raincloud plots
library(sdamr) # simultaneously nudge + jitter plot points
library(plotrix) # calculating standard error
library(scales) # scales on plots
library(patchwork) # combining plots
library(lme4) # linear mixed models
library(sjPlot) # lmm output
library(effsize) # effect sizes
```

### R / package versions used
```{r r_package_versions, message = FALSE, warning = FALSE}
R.Version() 
packageVersion('here')
packageVersion('tidyverse')
packageVersion('PupillometryR')
packageVersion('sdamr')
packageVersion('plotrix') 
packageVersion('scales')
packageVersion('patchwork')
packageVersion('lme4') 
packageVersion('sjPlot')
packageVersion('effsize')
```

## Read pre-wrangled data 
(see `00-wrangling-setup.Rmd` script)
```{r read_in_data}
# here::here() # Check we're working in the right place
apt <- readRDS(here("data", "apt-data.rds"))
apt <- as_tibble(apt)
head(apt)
```

Filter out participants who did not progress beyond interview
```{r}
apt <- apt %>% filter(selected != 0)
```

Filter out participants with deaf family members / L1 BSL
```{r}
apt <- apt %>% filter(L1_bsl != 1)
```

Convert data from long format to wide format
```{r}
apt_wide <- apt %>% 
  tidyr::pivot_wider(names_from = session,
                     values_from = c(nback_lett:grade_terp))
```
# Summary tables

### Dual N-Back
```{r nback_summary}
# Dual N-Back letter accuracy
apt %>% 
  filter(!is.na(nback_lett)) %>% 
  group_by(session) %>% 
  summarise(nback_lett_mean = mean(nback_lett), 
            sd = sd(nback_lett),
            se = std.error(nback_lett))

# Dual N-Back spatial accuracy
apt %>% 
  filter(!is.na(nback_spat)) %>% 
  group_by(session) %>% 
  summarise(nback_spat_mean = mean(nback_spat), 
            sd = sd(nback_spat),
            se = std.error(nback_spat))

# Dual N-Back combined accuracy
apt %>% 
  filter(!is.na(nback_comb)) %>% 
  group_by(session) %>% 
  summarise(nback_comb_mean = mean(nback_comb), 
            sd = sd(nback_comb),
            se = std.error(nback_comb))
```

### Corsi Blocks
```{r corsi_summary}
# Corsi Blocks block span
apt %>% 
  filter(!is.na(corsi_bspan)) %>% 
  group_by(session) %>% 
  summarise(corsi_bspan_mean = mean(corsi_bspan), 
            sd = sd(corsi_bspan),
            se = std.error(corsi_bspan))

# Corsi Blocks total score
apt %>% 
  filter(!is.na(corsi_score)) %>% 
  group_by(session) %>% 
  summarise(corsi_score_mean = mean(corsi_score), 
            sd = sd(corsi_score),
            se = std.error(corsi_score))

# Corsi Blocks correct responses
apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  group_by(session) %>% 
  summarise(corsi_corr_mean = mean(corsi_corr), 
            sd = sd(corsi_corr),
            se = std.error(corsi_corr))

# Corsi Blocks memory span
apt %>% 
  filter(!is.na(corsi_mspan)) %>% 
  group_by(session) %>% 
  summarise(corsi_mspan_mean = mean(corsi_mspan), 
            sd = sd(corsi_mspan),
            se = std.error(corsi_mspan))
```

### Kirklees Sentence Reading
```{r kirklees_summary}
# Kirklees ceiling score
apt %>% 
  filter(!is.na(kirk_ceil)) %>% 
  group_by(session) %>% 
  summarise(kirk_ceil_mean = mean(kirk_ceil), 
            sd = sd(kirk_ceil),
            se = std.error(kirk_ceil))

# Kirklees raw score
apt %>% 
  filter(!is.na(kirk_raw)) %>% 
  group_by(session) %>% 
  summarise(kirk_raw_mean = mean(kirk_raw), 
            sd = sd(kirk_raw),
            se = std.error(kirk_raw))

# Kirklees accuracy
apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  group_by(session) %>% 
  summarise(kirk_acc_mean = mean(kirk_acc), 
            sd = sd(kirk_acc),
            se = std.error(kirk_acc))
```

### KBIT-2 Matrices
```{r kbit_summary}
# KBIT-2 Matrices ceiling score
apt %>% 
  filter(!is.na(kbit_ceil)) %>% 
  group_by(session) %>% 
  summarise(kirk_ceil_mean = mean(kbit_ceil), 
            sd = sd(kbit_ceil),
            se = std.error(kbit_ceil))

# KBIT-2 Matrices raw score
apt %>% 
  filter(!is.na(kbit_raw)) %>% 
  group_by(session) %>% 
  summarise(kbit_raw_mean = mean(kbit_raw), 
            sd = sd(kbit_raw),
            se = std.error(kbit_raw))

# KBIT-2 Matrices accuracy
apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  group_by(session) %>% 
  summarise(kbit_acc_mean = mean(kbit_acc), 
            sd = sd(kbit_acc),
            se = std.error(kbit_acc))
```

### Digit Span
```{r dspan_summary}
# Digit Span memory span
apt %>% 
  filter(!is.na(dspan_mem)) %>% 
  group_by(session) %>% 
  summarise(dspan_mem_mean = mean(dspan_mem), 
            sd = sd(dspan_mem),
            se = std.error(dspan_mem))

# Digit Span accuracy
apt %>% 
  filter(!is.na(dspan_corr)) %>% 
  group_by(session) %>% 
  summarise(dspan_corr_mean = mean(dspan_corr), 
            sd = sd(dspan_corr),
            se = std.error(dspan_corr))
```

### 2D Mental Rotation
```{r 2dmr_summary}
# 2D Mental Rotation accuracy
apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  group_by(session) %>% 
  summarise(mr2d_acc_mean = mean(mr2d_acc), 
            sd = sd(mr2d_acc),
            se = std.error(mr2d_acc))

# 2D Mental Rotation reaction time
apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  group_by(session) %>% 
  summarise(mr2d_rt_mean = mean(mr2d_rt), 
            sd = sd(mr2d_rt),
            se = std.error(mr2d_rt))

# 2D Mental Rotation speed-accuracy trade-off score
apt %>% 
  filter(!is.na(mr2d_sats)) %>% 
  group_by(session) %>% 
  summarise(mr2d_sats_mean = mean(mr2d_sats), 
            sd = sd(mr2d_sats),
            se = std.error(mr2d_sats))
```

### 3D Mental Rotation
```{r 3dmr_summary}
# 3D Mental Rotation accuracy
apt %>% 
  filter(!is.na(mr3d_acc)) %>% 
  group_by(session) %>% 
  summarise(mr3d_acc_mean = mean(mr3d_acc), 
            sd = sd(mr3d_acc),
            se = std.error(mr3d_acc))

# 3D Mental Rotation reaction time
apt %>% 
  filter(!is.na(mr3d_rt)) %>% 
  group_by(session) %>% 
  summarise(mr3d_rt_mean = mean(mr3d_rt), 
            sd = sd(mr3d_rt),
            se = std.error(mr3d_rt))

# 3D Mental Rotation speed-accuracy trade-off score
apt %>% 
  filter(!is.na(mr3d_sats)) %>% 
  group_by(session) %>% 
  summarise(mr3d_sats_mean = mean(mr3d_sats), 
            sd = sd(mr3d_sats),
            se = std.error(mr3d_sats))
```

### Barratt Impulsiveness Scale
```{r bis_summary}
# BIS total score
apt %>% 
  filter(!is.na(bis_tot)) %>% 
  group_by(session) %>% 
  summarise(bis_tot_mean = mean(bis_tot), 
            sd = sd(bis_tot),
            se = std.error(bis_tot))

# BIS attention sub-score
apt %>% 
  filter(!is.na(bis_att)) %>% 
  group_by(session) %>% 
  summarise(bis_att_mean = mean(bis_att), 
            sd = sd(bis_att),
            se = std.error(bis_att))

# BIS motor sub-score
apt %>% 
  filter(!is.na(bis_mot)) %>% 
  group_by(session) %>% 
  summarise(bis_mot_mean = mean(bis_mot), 
            sd = sd(bis_mot),
            se = std.error(bis_mot))

# BIS non-planning sub-score
apt %>% 
  filter(!is.na(bis_nplan)) %>% 
  group_by(session) %>% 
  summarise(bis_nplan_mean = mean(bis_nplan), 
            sd = sd(bis_nplan),
            se = std.error(bis_nplan))
```

### Other predictors
Data for the MLAT Number Learning task and the Summarising Task were only collected at session 1 for two of three cohorts only, so there is no change over time to plot. The Barratt Impulsiveness Scale was only collected at sessions three and four, so no change over time was predicted.

# Plots
Let's plot the changes in the linguistic & cognitive predictor assessments over time
```{r plot-theme}
# set up a theme for the plots
theme_details <- theme_bw() + 
    theme(panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          panel.border = element_rect(colour = "black", size = 0.5),
          plot.title.position = "plot",
          plot.title = element_text(size = 16, face = "bold"),
          axis.title.x = element_text(size = 14, face = "bold"),
          axis.title.y = element_text(size = 14, face = "bold"),
          axis.text.x = element_text(size = 14, colour = "black"),
          axis.text.y = element_text(size = 14, colour = "black"),
          legend.position = "none")
pd <- position_dodge(0.5)
```

### Dual N-Back
How does performance on the Dual N-Back task change over time?

#### Letter matching
```{r nback_lett}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(nback_lett)) %>% 
  ggplot(aes(x = session, y = nback_lett, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +  
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy in letter matching during Dual N-Back Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )
  
# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(nback_lett)) %>% 
  summarize(mean=mean(nback_lett), sd = sd(nback_lett), se=std.error(nback_lett)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Accuracy in letter matching during Dual N-Back Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) 

indiv <- apt %>% 
  filter(!is.na(nback_lett)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(nback_lett)) #, sd = sd(nback_lett)) # requires trial level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Spatial matching
```{r nback_spat}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(nback_spat)) %>% 
  ggplot(aes(x = session, y = nback_spat, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +  
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy in spatial matching during Dual N-Back Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )
  
# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(nback_spat)) %>% 
  summarize(mean=mean(nback_spat), sd = sd(nback_spat), se=std.error(nback_spat)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Accuracy in spatial matching during Dual N-Back Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) 

indiv <- apt %>% 
  filter(!is.na(nback_spat)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(nback_spat)) #, sd = sd(nback_spat)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Combined accuracy
```{r nback_comb}
## Raincloud plot
( fig3a <- apt %>% 
  filter(!is.na(nback_comb)) %>% 
  ggplot(aes(x = session, y = nback_comb, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_x_discrete(labels = c('pre-degree\nn=30', '1st year\nn=10',
                              '2nd year\nn=11', '3rd year\nn=9')) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "a) Multimodal Working Memory by Session", 
       x = "Session", y = "Dual N-Back Accuracy") +
  theme_details )

# Jitter plot  
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(nback_comb)) %>% 
  summarize(mean=mean(nback_comb), sd = sd(nback_comb), se=std.error(nback_comb)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Combined accuracy on Dual N-Back Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1))

indiv <- apt %>% 
  filter(!is.na(nback_comb)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(nback_comb)) #, sd = sd(nback_comb)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

### Corsi Blocks
How does performance on the Corsi Blocks task change over time?
```{r corsi_corr}
# Raincloud plot
( fig3b <- apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  ggplot(aes(x = session, y = corsi_corr, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(5, 15)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +  
  scale_x_discrete(labels = c('pre-degree\nn=30', '1st year\nn=11',
                              '2nd year\nn=11', '3rd year\nn=9')) +
  scale_y_continuous(labels = scales::number_format(accuracy = 1)) +
  labs(title = "b) Visuospatial Working Memory by Session", 
       x = "Session", y = "Corsi Blocks Correct Responses") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(corsi_corr)) %>% 
  summarize(mean=mean(corsi_corr), sd = sd(corsi_corr), se=std.error(corsi_corr)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 15)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Correct Responses on Corsi Blocks Task by Session", 
       x = "Session", y = "Correct Response")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(corsi_corr)) #, sd = sd(corsi_corr)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```


### Kirklees Sentence Reading
How does performance on the Kirklees Sentence Reading task change over time?
```{r kirk_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  ggplot(aes(x = session, y = kirk_acc, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0.45, 1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +  
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on Kirklees Sentence Reading Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )
  
# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(kirk_acc)) %>% 
  summarize(mean=mean(kirk_acc), sd = sd(kirk_acc), se=std.error(kirk_acc)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on Kirklees Sentence Reading Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(kirk_acc)) #, sd = sd(kirk_acc) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

### KBIT-2 Matrices
How does performance on the KBIT-2 Matrices task change over time? 
```{r kbit_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  ggplot(aes(x = session, y = kbit_acc, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(.65, 1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +  
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on KBIT-2 Matrices Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )
  
# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(kbit_acc)) %>% 
  summarize(mean=mean(kbit_acc), 
            sd = sd(kbit_acc), se=std.error(kbit_acc)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(.5, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on KBIT-2 Matrices Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(kbit_acc)) #, sd = sd(kbit_acc) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )  
```

### Digit Span
How does performance on the Digit Span task change over time?

#### Accuracy
```{r dspan_corr}
# Raincloud plot
( fig3c <- apt %>% 
  #filter(!is.na(dspan_corr)) %>% 
  ggplot(aes(x = session, y = dspan_corr, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0.5, 0.9)) +
  scale_fill_manual(values = c("#7bccc4", "#43a2ca", "#0868ac", "#bae4bc")) + 
  scale_x_discrete(labels = c('pre-degree\nn=18', '1st year\nn=0',
                              '2nd year\nn=11', '3rd year\nn=9')) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "c) Auditory Working Memory by Session", 
       x = "Session", y = "Digit Span Accuracy") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  #filter(!is.na(dspan_corr)) %>% 
  summarize(mean=mean(dspan_corr), 
            sd = sd(dspan_corr), se=std.error(dspan_corr)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0.5, 0.9)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Digit Span Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  #filter(!is.na(dspan_corr)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(dspan_corr)) #, sd = sd(dspan_corr)) # requires trial-level data

indiv2 <- apt %>% 
  filter(!is.na(dspan_corr)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(dspan_corr)) #, sd = sd(dspan_corr)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv2, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Memory Span
```{r dspan_mem}
# Raincloud plot
( R1 <- apt %>% 
  #filter(!is.na(dspan_mem)) %>% 
  ggplot(aes(x = session, y = dspan_mem, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(4, 11)) +
  scale_fill_manual(values = c("#7bccc4", "#43a2ca", "#0868ac", "#bae4bc")) +   
  labs(title = "Memory Span on Digit Span Task by Session", 
       x = "Session", y = "Memory Span") +
  theme_details )
  
# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(dspan_mem)) %>% 
  summarize(mean=mean(dspan_mem), 
            sd = sd(dspan_mem), se=std.error(dspan_mem)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 8)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(4, 11)) +
  labs(title = "Memory Span on Digit Span Task by Session", 
       x = "Session", y = "Memory Span")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(dspan_mem)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(dspan_mem)) #, sd = sd(dspan_mem)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```


### 2D Mental Rotation
How does performance on the 2D Mental Rotation task change over time?

#### Accuracy
```{r mr2d_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  ggplot(aes(x = session, y = mr2d_acc, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0.5, 1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 2D Mental Rotation Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr2d_acc)) %>% 
  summarize(mean=mean(mr2d_acc), sd = sd(mr2d_acc), se=std.error(mr2d_acc)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0.5, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 2D Mental Rotation Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr2d_acc)) #, sd = sd(mr2d_acc)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 

# Raincloud + Jitter
( RJ <- apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  ggplot(aes(x = session, y = mr2d_acc, group = session, fill = session)) +
  geom_point(data=indiv, aes(x = session, y = mean, group = ppt),
             position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  geom_line(data = indiv, aes(x = session, y = mean, group = ppt),
                      size = 0.1, alpha = 0.3, 
            position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  coord_cartesian(ylim = c(0.5, 1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 2D Mental Rotation Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )

```

#### Reaction Time
```{r mr2d_rt}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  ggplot(aes(x = session, y = mr2d_rt, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0, 8500)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Reaction Time on 2D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr2d_rt)) %>% 
  summarize(mean=mean(mr2d_rt), sd = sd(mr2d_rt), se=std.error(mr2d_rt)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 8500)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Reaction Time on 2D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  filter(ppt != "HW025") %>% ## removing extreme outlier
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr2d_rt)) #, sd = sd(mr2d_rt)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )


# Raincloud + Jitter plot
( RJ <- apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  filter(ppt != "HW025") %>% ## removing extreme outlier
  ggplot(aes(x = session, y = mr2d_rt, group = session, fill = session)) +
  geom_line(data = indiv, aes(x = session, y = mean, group = ppt),
                      size = 0.1, alpha = 0.3, position = pd) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(0, 4500)) +
  labs(title = "Reaction Time on 2D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)") +
  theme_details )
```


#### Speed-Accuracy Trade-off Score
```{r mr2d-sats}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr2d_sats)) %>% 
  ggplot(aes(x = session, y = mr2d_sats, group = session, fill = session)) +
  geom_hline(yintercept = 0, alpha = 0.4, linetype = "dashed") +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(-3, 3)) +
  labs(title = "Speed-Accuracy Trade-off Score on 2D Mental Rotation Task by Session", 
       x = "Session", 
       y = "Speed-Accuracy Trade-off Score\n(Balanced Integration Score") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr2d_sats)) %>% 
  summarize(mean=mean(mr2d_sats), sd = sd(mr2d_sats), se=std.error(mr2d_sats)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(-3, 3)) +
  geom_hline(yintercept = 0, alpha = 0.4, linetype = "dashed") +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Speed-Accuracy Trade-off Score on 2D Mental Rotation Task by Session", 
       x = "Session", 
       y = "Speed-Accuracy Trade-off Score\n(Balanced Integration Score)")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr2d_sats)) %>% 
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr2d_sats)) #, sd = sd(mr2d_rt)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )

( RJ <- apt %>% 
  filter(!is.na(mr2d_sats)) %>% 
  ggplot(aes(x = session, y = mr2d_sats, group = session, fill = session)) +
  geom_hline(yintercept = 0, alpha = 0.4, linetype = "dashed") +
  geom_line(data = indiv, aes(x = session, y = mean, group = ppt),
                      size = 0.1, alpha = 0.5, position = pd) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(-3, 2)) +
  labs(title = "Speed-Accuracy Trade-off Score on 2D Mental Rotation Task by Session", 
       x = "Session", 
       y = "Speed-Accuracy Trade-off Score\n(Balanced Integration Score)") +
  theme_details )
```

### 3D Mental Rotation
How does performance on the 3D Mental Rotation task change over time?

#### Accuracy
```{r mr3d_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr3d_acc)) %>% 
  #filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  ggplot(aes(x = session, y = mr3d_acc, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0, 1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 3D Mental Rotation Task by Session", 
       x = "Session", y = "Accuracy") +
  theme_details )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr3d_acc)) %>% 
  #filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  summarize(mean=mean(mr3d_acc), sd = sd(mr3d_acc), se=std.error(mr3d_acc)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 3D Mental Rotation Task by Session", 
       x = "Session", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr3d_acc)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr3d_acc)) #, sd = sd(mr3d_acc)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

#### Reaction Time
```{r mr3d_rt}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr3d_rt)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  ggplot(aes(x = session, y = mr3d_rt, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(0, 4500)) +
  scale_fill_manual(values = c("#bae4bc", "#43a2ca", "#0868ac")) +
  labs(title = "Reaction Time on 3D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)") )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr3d_rt)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  summarize(mean=mean(mr3d_rt), sd = sd(mr3d_rt), se=std.error(mr3d_rt)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 4500)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#43a2ca", "#0868ac")) +
  labs(title = "Reaction Time on 3D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr3d_rt)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr3d_rt)) #, sd = sd(mr3d_rt)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )

# Raincloud + Jitter
( RJ <- apt %>% 
  filter(!is.na(mr3d_rt)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  ggplot(aes(x = session, y = mr3d_rt, group = session, fill = session)) +
  geom_line(data = indiv, aes(x = session, y = mean, group = ppt),
                      size = 0.1, alpha = 0.3, position = pd) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(data=indiv, aes(x = session, y = mean, group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
  scale_fill_manual(values = c("#bae4bc", "#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(0, 4500)) +
  labs(title = "Reaction Time on 3D Mental Rotation Task by Session", 
       x = "Session", y = "RT (ms)") )
```

#### Speed-Accuracy Trade-off Score
```{r mr3d-sats}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr3d_sats)) %>% 
  ggplot(aes(x = session, y = mr3d_sats, group = session, fill = session)) +
  geom_hline(yintercept = 0, alpha = .3) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  coord_cartesian(ylim = c(-4, 3)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Speed-Accuracy Trade-off Score on 3D Mental Rotation Task by Session", 
       x = "Session", 
       y = "Speed-Accuracy Trade-off Score\n(Balanced Integration Score)") )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(mr3d_sats)) %>% 
  #filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  summarize(mean=mean(mr3d_sats), sd = sd(mr3d_sats), se=std.error(mr3d_sats)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(-4, 3)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Speed-Accuracy Trade-off Score on 3D Mental Rotation Task by Session", 
       x = "Session", 
       y = "Speed-Accuracy Trade-off Score\n(Balanced Integration Score)") 

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr3d_sats)) %>% 
  #filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  group_by(session, ppt) %>% 
  summarise(mean = mean(mr3d_sats)) #, sd = sd(mr3d_sats)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )

# Raincloud + Jitter
( fig3d <- apt %>% 
  filter(!is.na(mr3d_sats)) %>% 
  ggplot(aes(x = session, y = mr3d_sats, group = session, fill = session)) +
  geom_hline(yintercept = 0, alpha = 0.4, linetype = "dashed") +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .3, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_x_discrete(labels = c('pre-degree\nn=21', '1st year\nn=2',
                              '2nd year\nn=13', '3rd year\nn=9')) +  
  coord_cartesian(ylim = c(-4, 3)) +
  labs(title = "d) 3D Mental Rotation by Session", 
       x = "Session", y = "Speed-Accuracy Trade-off Score") +
  theme_details )
```

Combine plots for Figure 3 using patchwork:
```{r}
fig3 <- (fig3a | fig3b)/(fig3c | fig3d)
ggsave("plots/Fig3.jpeg", plot=fig3, width = 12, height = 8, units = "in")
```

### Barratt Impulsiveness Scale
How does performance on the BIS change over time?
```{r bis_tot}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(bis_tot)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  ggplot(aes(x = session, y = bis_tot, group = session, fill = session)) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0),
                   adjust = 2, trim = TRUE, alpha = 1) +
  geom_point(position = position_jitternudge(seed=42,jitter.width = .4, nudge.x = -.15), 
                        size = 2, shape = 21) +
  scale_fill_manual(values = c("#43a2ca", "#0868ac")) +
  coord_cartesian(ylim = c(0, 100)) +
  labs(title = "Total Score on Barratt Impulsiveness Scale by Session", 
       x = "Session", y = "Total Score") )

# Jitter plot
J1 <- apt %>% 
  group_by(session) %>% 
  filter(!is.na(bis_tot)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  summarize(mean=mean(bis_tot), sd = sd(bis_tot), se=std.error(bis_tot)) %>%
  ggplot(aes(x = session, y = mean, fill = session)) +
  coord_cartesian(ylim = c(0, 100)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#43a2ca", "#0868ac")) +
  labs(title = "Total Score on Barratt Impulsiveness Scale by Session", 
       x = "Session", y = "Total Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(bis_tot)) %>% 
  filter(session != "1st year") %>% #only 2 ppts at 2nd session>filter out
  group_by(session, ppt) %>% 
  summarise(mean = mean(bis_tot)) #, sd = sd(mr3d_acc)) # requires trial-level data

J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

# Models
Having summarised and plotted the data, now let's fit models to see whether session is a predictor of changes in the performance on each of the cognitive and linguistic assessments. We add BSL self-rating as a co-efficient
              
## Dual N-Back
```{r nback-mdl}
# Does session predict Dual N-Back results?
( nback_comb_mdl <- lmer(nback_comb ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(nback_comb_mdl)
tab_model(nback_comb_mdl, show.aic = T)

# calculate effect size
a <- apt_wide %>% 
  filter(`nback_comb_pre-degree`!= "NA") %>% 
  filter(`nback_comb_2nd year` != "NA")
cohen.d(a$`nback_comb_pre-degree`, a$`nback_comb_2nd year`)

( nback_lett_mdl <- lmer(nback_lett ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(nback_lett_mdl)
tab_model(nback_lett_mdl, show.aic = T)

( nback_spat_mdl <- lmer(nback_spat ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(nback_spat_mdl)
tab_model(nback_spat_mdl, show.aic = T)
```

## Corsi Blocks
```{r corsi-mdl}
# Does session predict Corsi Blocks results?
( corsi_corr_mdl <- lmer(corsi_corr ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(corsi_corr_mdl)
tab_model(corsi_corr_mdl, show.aic = T)

# effect size
a <- apt_wide %>% 
  filter(`corsi_corr_pre-degree`!= "NA") %>% 
  filter(`corsi_corr_1st year` != "NA")
cohen.d(a$`corsi_corr_pre-degree`, a$`corsi_corr_1st year`)
```

## Kirklees Sentence Reading
```{r kirk-mdl}
# Does session predict Kirklees Sentence Reading results?
( kirk_mdl <- lmer(kirk_acc ~ session + self_rating +
                   #age_s1 + # removing age from public script for data protection reasons
                   (1|ppt), 
                   data = apt) ) 

summary(kirk_mdl)
tab_model(kirk_mdl, show.aic = T)
# NB these results are very slightly different to those reported in the manuscript, due to the removal of age as a co-variate to protect participant anonymity
```

## KBIT-2 Matrices
```{r kbit-mdl}
# Does session predict KBIT-2 Matrices results?
( kbit_mdl <- lmer(kbit_acc ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(kbit_mdl)
tab_model(kbit_mdl, show.aic = T)
```

## Digit Span
```{r dspan-mdl}
# Does session predict Digit Span results?
( dspan_corr_mdl <- lmer(dspan_corr ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(dspan_corr_mdl)
tab_model(dspan_corr_mdl, show.aic = T)

( dspan_mem_mdl <- lmer(dspan_mem ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(dspan_mem_mdl)

# effect size
a <- apt_wide %>% 
  filter(`dspan_corr_pre-degree`!= "NA") %>% 
  filter(`dspan_corr_3rd year` != "NA")
cohen.d(a$`dspan_corr_pre-degree`, a$`dspan_corr_3rd year`)
```

## 2D Mental Rotation
```{r mr2d-mdl}
# Does session predict 2D Mental Rotation SATS?
( mr2d_sats_mdl <- lmer(mr2d_sats ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(mr2d_sats_mdl)
tab_model(mr2d_sats_mdl, show.aic = T)

# effect size
a <- apt_wide %>% 
  filter(`mr2d_sats_pre-degree`!= "NA") %>% 
  filter(`mr2d_sats_3rd year` != "NA")
cohen.d(a$`mr2d_sats_pre-degree`, a$`mr2d_sats_3rd year`)
# cannot calculate, not all participants completed this task at all sessions

( mr2d_acc_mdl <- lmer(mr2d_acc ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(mr2d_acc_mdl)
tab_model(mr2d_acc_mdl, show.aic = T)

( mr2d_rt_mdl <- lmer(mr2d_rt ~ session + self_rating + (1|ppt), 
                  data = apt) ) 

summary(mr2d_rt_mdl)
tab_model(mr2d_rt_mdl, show.aic = T)

# effect size
a <- apt_wide %>% 
  filter(`mr2d_rt_pre-degree`!= "NA") %>% 
  filter(`mr2d_rt_1st year` != "NA")
cohen.d(a$`mr2d_rt_pre-degree`, a$`mr2d_rt_1st year`)
```

## 3D Mental Rotation
```{r mr3d-mdl}
# Does session predict 3D Mental Rotation results?
( mr3d_sats_mdl <- lmer(mr3d_sats ~ session + self_rating + (1|ppt), 
                  data = apt) ) 
summary(mr3d_sats_mdl)
tab_model(mr3d_sats_mdl, show.aic = T)

# effect sizes
a <- apt_wide %>% 
  filter(`mr3d_sats_pre-degree`!= "NA") %>% 
  filter(`mr3d_sats_1st year` != "NA")
cohen.d(a$`mr3d_sats_pre-degree`, a$`mr3d_sats_1st year`)

a <- apt_wide %>% 
  filter(`mr3d_sats_pre-degree`!= "NA") %>% 
  filter(`mr3d_sats_2nd year` != "NA")
cohen.d(a$`mr3d_sats_pre-degree`, a$`mr3d_sats_2nd year`)

a <- apt_wide %>% 
  filter(`mr3d_sats_pre-degree`!= "NA") %>% 
  filter(`mr3d_sats_3rd year` != "NA")
cohen.d(a$`mr3d_sats_pre-degree`, a$`mr3d_sats_3rd year`)

( mr3d_acc_mdl <- lmer(mr3d_acc ~ session + self_rating + (1|ppt), 
                  data = apt) ) 
summary(mr3d_acc_mdl)
tab_model(mr3d_acc_mdl, show.aic = T)

a <- apt_wide %>% 
  filter(`mr3d_acc_pre-degree`!= "NA") %>% 
  filter(`mr3d_acc_1st year` != "NA")
cohen.d(a$`mr3d_acc_pre-degree`, a$`mr3d_acc_3rd year`)

( mr3d_rt_mdl <- lmer(mr3d_rt ~ session + self_rating + (1|ppt), 
                  data = apt) ) 
summary(mr3d_rt_mdl)
tab_model(mr3d_rt_mdl, show.aic = T)

a <- apt_wide %>% 
  filter(`mr3d_rt_pre-degree`!= "NA") %>% 
  filter(`mr3d_rt_1st year` != "NA")
cohen.d(a$`mr3d_rt_pre-degree`, a$`mr3d_rt_1st year`)

a <- apt_wide %>% 
  filter(`mr3d_rt_pre-degree`!= "NA") %>% 
  filter(`mr3d_rt_2nd year` != "NA")
cohen.d(a$`mr3d_rt_pre-degree`, a$`mr3d_rt_2nd year`)

a <- apt_wide %>% 
  filter(`mr3d_rt_pre-degree`!= "NA") %>% 
  filter(`mr3d_rt_3rd year` != "NA")
cohen.d(a$`mr3d_rt_pre-degree`, a$`mr3d_rt_3rd year`)
```

## Barratt Impulsiveness Scale
```{r bis-mdl}
# relevel session because data only for 2nd year vs 3rd year
apt$session <- fct_relevel(apt$session, "2nd year", after = 0)

apt_bis <- apt %>% filter(session != "1st year") # only 2 ppts at 2nd session>filter out

# Does session predict Barratt Impulsiveness Scale results?
( bis_mdl <- lmer(bis_tot ~ session + self_rating + (1|ppt), 
                  data = apt_bis) ) 

summary(bis_mdl)
tab_model(bis_mdl, show.aic = T)

# effect size
a <- apt_wide %>% 
  filter(`bis_tot_2nd year` != "NA") %>% 
  filter(`bis_tot_3rd year` != "NA")
cohen.d(a$`bis_tot_2nd year`, a$`bis_tot_3rd year`)

# relevel back again 
apt$session <- fct_relevel(apt$session, "2nd year", after = 2)
```

This concludes our Change over time analysis.