---
title: "Sign Language Interpreter Aptitude"
subtitle: "01 - Group Analysis"
author:
  - name: "Freya Watkins"
    affiliation: "University of Birmingham"
date: "`r format(Sys.Date(), '%d %B %Y')`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 5
    number_sections: false
    theme: flatly
    highlight: haddock
---

# Setup
```{r setup, include=FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

## Load packages
```{r load_packages, message = FALSE, warning = FALSE}
library(here) # file organisation & folder location
library(tidyverse) # data wrangling & plotting
library(PupillometryR) # raincloud plots
library(plotrix) # for calculating standard error
library(scales) # scales on plots
library(lme4) # for linear mixed models
library(afex) # for linear mixed models
library(psych) # for factor analysis
```

### R / package versions used
```{r r_package_versions, message = FALSE, warning = FALSE}
R.Version() 
packageVersion('here')
packageVersion('tidyverse')
packageVersion('PupillometryR') 
packageVersion('plotrix') 
packageVersion('scales') 
packageVersion('lme4') 
packageVersion('afex')
packageVersion('psych')
```

## Read in data
```{r read_in_data}
here::here()
apt <- read_csv(here("data", "2022-03-17_SLI_aptitude_data.csv"))
apt <- as_tibble(apt)
```

### Convert variables   

Fix the variables that are character when they should be factor, or numeric:  
```{r convert_variables}
# convert session, group, ppt & status to factor
apt <- mutate(apt, across(c("session", "group", "ppt", "status"), factor))

# convert these character variables to numeric
apt <- mutate(apt, across(c("L1_bsl", "prior_BSL", "age_s1", "dspan_time",
                            "bis_tot", "bis_att","bis_mot", "bis_nplan", "summ",
                            "copy_sign", "copy_sign", "bsl_srt", "town_map",
                            "terp_b2e"), as.numeric))
```

Rename levels of session:  
```{r relevel_session}
apt$session <- plyr::revalue(apt$session, c("1" = "pre-degree", 
                                            "2" = "1st year", 
                                            "3" = "2nd year",
                                            "4" = "3rd year"))
```

# Group Analysis
## Summary tables

```{r grouping}
apt <- filter(apt, session == "pre-degree")

apt %>% 
  dplyr::group_by(status) %>% 
  count()
```

### Dual N-Back
```{r nback_summary}
apt %>% 
  filter(!is.na(nback_lett)) %>% 
  group_by(status) %>% 
  summarise(nback_lett_mean = mean(nback_lett), 
            sd = sd(nback_lett),
            se = std.error(nback_lett))

apt %>% 
  filter(!is.na(nback_spat)) %>% 
  group_by(status) %>% 
  summarise(nback_spat_mean = mean(nback_spat), 
            sd = sd(nback_spat),
            se = std.error(nback_spat))

apt %>% 
  filter(!is.na(nback_comb)) %>% 
  group_by(status) %>% 
  summarise(nback_comb_mean = mean(nback_comb), 
            sd = sd(nback_comb),
            se = std.error(nback_comb))
```

### Corsi Blocks
```{r corsi_summary}
apt %>% 
  filter(!is.na(corsi_bspan)) %>% 
  group_by(status) %>% 
  summarise(corsi_bspan_mean = mean(corsi_bspan), 
            sd = sd(corsi_bspan),
            se = std.error(corsi_bspan))

apt %>% 
  filter(!is.na(corsi_score)) %>% 
  group_by(status) %>% 
  summarise(corsi_score_mean = mean(corsi_score), 
            sd = sd(corsi_score),
            se = std.error(corsi_score))

apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  group_by(status) %>% 
  summarise(corsi_corr_mean = mean(corsi_corr), 
            sd = sd(corsi_corr),
            se = std.error(corsi_corr))

apt %>% 
  filter(!is.na(corsi_mspan)) %>% 
  group_by(status) %>% 
  summarise(corsi_mspan_mean = mean(corsi_mspan), 
            sd = sd(corsi_mspan),
            se = std.error(corsi_mspan))
```

### Kirklees Sentence Reading
```{r kirklees_summary}
apt %>% 
  filter(!is.na(kirk_ceil)) %>% 
  group_by(status) %>% 
  summarise(kirk_ceil_mean = mean(kirk_ceil), 
            sd = sd(kirk_ceil),
            se = std.error(kirk_ceil))

apt %>% 
  filter(!is.na(kirk_raw)) %>% 
  group_by(status) %>% 
  summarise(kirk_raw_mean = mean(kirk_raw), 
            sd = sd(kirk_raw),
            se = std.error(kirk_raw))

apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  group_by(status) %>% 
  summarise(kirk_acc_mean = mean(kirk_acc), 
            sd = sd(kirk_acc),
            se = std.error(kirk_acc))
```

### KBIT-2 Matrices
```{r kbit_summary}
apt %>% 
  filter(!is.na(kbit_ceil)) %>% 
  group_by(status) %>% 
  summarise(kirk_ceil_mean = mean(kbit_ceil), 
            sd = sd(kbit_ceil),
            se = std.error(kbit_ceil))

apt %>% 
  filter(!is.na(kbit_raw)) %>% 
  group_by(status) %>% 
  summarise(kbit_raw_mean = mean(kbit_raw), 
            sd = sd(kbit_raw),
            se = std.error(kbit_raw))

apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  group_by(status) %>% 
  summarise(kbit_acc_mean = mean(kbit_acc), 
            sd = sd(kbit_acc),
            se = std.error(kbit_acc))
```

### 2D Mental Rotation
```{r 2dmr_summary}
apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  group_by(status) %>% 
  summarise(mr2d_acc_mean = mean(mr2d_acc), 
            sd = sd(mr2d_acc),
            se = std.error(mr2d_acc))

apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  group_by(status) %>% 
  summarise(mr2d_rt_mean = mean(mr2d_rt), 
            sd = sd(mr2d_rt),
            se = std.error(mr2d_rt))
```

## Plots

### Dual N-Back
#### Accuracy in letter matching
```{r nback_lett}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(nback_lett)) %>% 
  ggplot(aes(x = status, y = nback_lett, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy in letter matching during Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(nback_lett)) %>% 
  summarize(mean=mean(nback_lett), sd = sd(nback_lett), se=std.error(nback_lett)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Accuracy in letter matching during Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) 

indiv <- apt %>% 
  filter(!is.na(nback_lett)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(nback_lett)) #, sd = sd(nback_lett)) # requires trial level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

theme_details <- theme_bw() + 
    theme(panel.grid.major = element_blank(), 
          panel.grid.minor = element_blank(),
          panel.border = element_rect(colour = "black", size=0.5),
          axis.title.x = element_text(face = "bold"),
          legend.position = "none",
          axis.title.y = element_text(face = "bold"),
          axis.text.x=element_text(size=10, colour="black"),
          axis.text.y=element_text(colour="black"))

( J4 <- J3 + theme_details )
```

#### Accuracy in spatial matching
```{r nback_spat}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(nback_spat)) %>% 
  ggplot(aes(x = status, y = nback_spat, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy in spatial matching during Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(nback_spat)) %>% 
  summarize(mean=mean(nback_spat), sd = sd(nback_spat), se=std.error(nback_spat)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Accuracy in spatial matching during Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) 

indiv <- apt %>% 
  filter(!is.na(nback_spat)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(nback_spat)) #, sd = sd(nback_spat)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Combined accuracy
```{r nback_comb}
## Raincloud plot
apt %>% 
  filter(!is.na(nback_comb)) %>% 
  ggplot(aes(x = status, y = nback_comb, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Combined accuracy on Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy")

# Jitter plot  
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(nback_comb)) %>% 
  summarize(mean=mean(nback_comb), sd = sd(nback_comb), se=std.error(nback_comb)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  coord_cartesian(ylim = c(0.5, 0.8)) +
  theme_minimal() +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Combined accuracy on Dual N-Back Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5) +
  scale_y_continuous(labels = percent_format(accuracy=1))

indiv <- apt %>% 
  filter(!is.na(nback_comb)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(nback_comb)) #, sd = sd(nback_comb)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

### Corsi Blocks
#### Block Span
```{r corsi_bspan}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(corsi_bspan)) %>% 
  ggplot(aes(x = status, y = corsi_bspan, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Block span on Corsi Blocks Task by Group", 
       x = "Group", y = "Block Span") )

# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(corsi_bspan)) %>% 
  summarize(mean=mean(corsi_bspan), sd = sd(corsi_bspan), se=std.error(corsi_bspan)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 10)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Block span on Corsi Blocks Task by Group", 
       x = "Group", y = "Block Span")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(corsi_bspan)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(corsi_bspan)) #, sd = sd(corsi_bspan)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

#### Raw Score
```{r corsi_score}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(corsi_score)) %>% 
  ggplot(aes(x = status, y = corsi_score, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Raw Score on Corsi Blocks Task by Group", 
       x = "Group", y = "Score") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(corsi_score)) %>% 
  summarize(mean=mean(corsi_score), sd = sd(corsi_score), se=std.error(corsi_score)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 125)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Raw Score on Corsi Blocks Task by Group", 
       x = "Group", y = "Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(corsi_score)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(corsi_score)) #, sd = sd(corsi_score)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Correct Responses
```{r corsi_corr}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  ggplot(aes(x = status, y = corsi_corr, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5)  +
  coord_cartesian(ylim = c(5, 15)) +
  scale_y_continuous(labels = scales::number_format(accuracy = 1)) +
  labs(title = "Correct Responses on Corsi Blocks Task by Group", 
       x = "Group", y = "Correct Response") )

# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(corsi_corr)) %>% 
  summarize(mean=mean(corsi_corr), sd = sd(corsi_corr), se=std.error(corsi_corr)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 15)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Correct Responses on Corsi Blocks Task by Group", 
       x = "Group", y = "Correct Response")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(corsi_corr)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(corsi_corr)) #, sd = sd(corsi_corr)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )  
```

#### Memory Span
```{r corsi_mspan}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(corsi_mspan)) %>% 
  ggplot(aes(x = status, y = corsi_mspan, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Memory Span on Corsi Blocks Task by Group", 
       x = "Group", y = "Memory Span") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(corsi_mspan)) %>% 
  summarize(mean=mean(corsi_mspan), sd = sd(corsi_mspan), se=std.error(corsi_mspan)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 8)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Memory Span on Corsi Blocks Task by Group", 
       x = "Group", y = "Memory Span")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(corsi_mspan)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(corsi_mspan)) #, sd = sd(corsi_mspan)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

### Kirklees Sentence Reading
#### Ceiling Score
```{r kirk_ceil}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kirk_ceil)) %>% 
  ggplot(aes(x = status, y = kirk_ceil, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Ceiling Score on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Ceiling Score") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kirk_ceil)) %>% 
  summarize(mean=mean(kirk_ceil), sd = sd(kirk_ceil), se=std.error(kirk_ceil)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 45)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Ceiling Score on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Ceiling Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kirk_ceil)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kirk_ceil)) #, sd = sd(kirk_ceil) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

#### Raw Score
```{r kirk_raw}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kirk_raw)) %>% 
  ggplot(aes(x = status, y = kirk_raw, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Raw Score on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Ceiling Score") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kirk_raw)) %>% 
  summarize(mean=mean(kirk_raw), sd = sd(kirk_raw), se=std.error(kirk_raw)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 45)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Raw Score on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Raw Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kirk_raw)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kirk_raw)) #, sd = sd(kirk_raw) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Accuracy
```{r kirk_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  ggplot(aes(x = status, y = kirk_acc, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  coord_cartesian(ylim = c(0.45, 1)) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Accuracy") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kirk_acc)) %>% 
  summarize(mean=mean(kirk_acc), sd = sd(kirk_acc), se=std.error(kirk_acc)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on Kirklees Sentence Reading Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kirk_acc)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kirk_acc)) #, sd = sd(kirk_acc) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

### KBIT-2 Matrices

#### Ceiling Score
```{r kbit_ceil}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kbit_ceil)) %>% 
  ggplot(aes(x = status, y = kbit_ceil, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Ceiling Score on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Ceiling Score") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kbit_ceil)) %>% 
  summarize(mean=mean(kbit_ceil), sd = sd(kbit_ceil), se=std.error(kbit_ceil)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 48)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Ceiling Score on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Ceiling Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kirk_ceil)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kbit_ceil)) #, sd = sd(kbit_ceil) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

#### Raw Score
```{r kbit_raw}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kbit_raw)) %>% 
  ggplot(aes(x = status, y = kbit_raw, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  labs(title = "Raw Score on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Ceiling Score") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kbit_raw)) %>% 
  summarize(mean=mean(kbit_raw), sd = sd(kbit_raw), se=std.error(kbit_raw)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 45)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca")) +
  labs(title = "Raw Score on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Raw Score")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kbit_raw)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kbit_raw)) #, sd = sd(kbit_raw) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

#### Accuracy
```{r kbit_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  ggplot(aes(x = status, y = kbit_acc, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5) +
  coord_cartesian(ylim = c(.65, 1)) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Accuracy") )
  
# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(kbit_acc)) %>% 
  summarize(mean=mean(kbit_acc), 
            sd = sd(kbit_acc), se=std.error(kbit_acc)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(.5, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = percent_format(accuracy=1)) +
  labs(title = "Accuracy on KBIT-2 Matrices Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(kbit_acc)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(kbit_acc)) #, sd = sd(kbit_acc) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```

### 2D Mental Rotation
#### Accuracy
```{r mr2d_acc}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  ggplot(aes(x = status, y = mr2d_acc, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5)  +
  coord_cartesian(ylim = c(0, 1)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 2D Mental Rotation Task by Group", 
       x = "Group", y = "Accuracy") )

# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(mr2d_acc)) %>% 
  summarize(mean=mean(mr2d_acc), sd = sd(mr2d_acc), se=std.error(mr2d_acc)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 1)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1L)) +
  labs(title = "Accuracy on 2D Mental Rotation Task by Group", 
       x = "Group", y = "Accuracy")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr2d_acc)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(mr2d_acc)) #, sd = sd(mr2d_acc)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details ) 
```

#### Reaction Time
```{r mr2d_rt}
# Raincloud plot
( R1 <- apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  ggplot(aes(x = status, y = mr2d_rt, group = status)) +
  geom_flat_violin(position = position_nudge(x = .25, y = 0),
                   adjust = 2, trim = TRUE, alpha = 0.3) +
  geom_point(position = position_jitter(width = .15), 
                        size = 0.5)  +
  coord_cartesian(ylim = c(0, 9000)) +
  labs(title = "Reaction Time on 2D Mental Rotation Task by Group", 
       x = "Group", y = "RT (ms)") )

# Jitter plot
J1 <- apt %>% 
  group_by(status) %>% 
  filter(!is.na(mr2d_rt)) %>% 
  summarize(mean=mean(mr2d_rt), sd = sd(mr2d_rt), se=std.error(mr2d_rt)) %>%
  ggplot(aes(x = status, y = mean, fill = status)) +
  coord_cartesian(ylim = c(0, 9000)) +
  geom_bar(stat = 'identity', position = position_dodge()) +
  theme_minimal() +
  scale_fill_manual(values = c("#bae4bc", "#7bccc4", "#43a2ca", "#0868ac")) +
  labs(title = "Reaction Time on 2D Mental Rotation Task by Group", 
       x = "Group", y = "RT (ms)")

limits <- aes(ymax = mean + se, ymin = mean - se)
J2 <- J1 + geom_errorbar(position = position_dodge(), 
                          limits, size = 0.5, width = 0.5)

indiv <- apt %>% 
  filter(!is.na(mr2d_rt)) %>% 
  group_by(status, ppt) %>% 
  summarise(mean = mean(mr2d_rt)) #, sd = sd(mr2d_rt)) # requires trial-level data

pd <- position_dodge(0.5)
J3 <- J2 + geom_point(data=indiv, aes(group = ppt), size = 0.8, 
                       shape = 19, position = pd) +
    geom_line(data = indiv, aes(group = ppt),
                      size = 0.1, position = pd)

( J4 <- J3 + theme_details )
```


# Models
Which initial assessments best predict being selected for the degree?
```{r selected-model}

# Fit linear model based on Dual N-Back, Corsi, Kirklees & KBIT-2 predictors
( selected_mdl <- glm(selected ~ nback_comb + 
                                 corsi_corr + 
                                 kirk_acc + 
                                 kbit_acc, 
                                 family = binomial, 
                                 data = apt) ) 
summary(selected_mdl)

# Filter to just the pilot cohort
pilot_dat <- apt %>% filter(group == "pilot")

# Re-run model on just pilot cohort with 2D mental rotation task predictor too
( pilot_selected_mdl <- glm(selected ~ nback_comb + 
                                 corsi_corr + 
                                 kirk_acc + 
                                 kbit_acc + 
                                 mr2d_acc, 
                                 family = binomial, 
                                 data = pilot_dat) ) 
summary(pilot_selected_mdl)
```



Which initial assessments best predict remaining in the degree?
```{r drop-out-model}
# filter out rejected-at-interview participants
selected <- apt %>% filter(status != "rejected")

# fit logistic regression model
( continue_mdl <- glm(continue ~ nback_comb + 
                                 corsi_corr + 
                                 kirk_acc + 
                                 kbit_acc,
                                 family = binomial, 
                                 data = selected) ) 

summary(continue_mdl)
```

+ smaller analysis with the extra assessments done at S1 for the grant cohort
```{r}
# Filter to just the pilot cohort
grant_dat <- apt %>% filter(group == "grant")

# fit logistic regression model
( continue_mdl2 <- glm(continue ~ dspan_corr + 
                                  mr3d_acc,
                                  family = binomial, 
                                  data = grant_dat) ) 

summary(continue_mdl2)
```

